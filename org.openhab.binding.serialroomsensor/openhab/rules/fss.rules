// Regeln werden mit Hilfe von Xtend definiert  


rule BrightnessChanged
when
	Item FF_CR_Brightness changed
then
	callScript("nightLightOrOff")
end

rule LightSceneChangedOn
when
	Item FF_CR_LightScene received command
then

	var Number scene = FF_CR_LightScene.state as DecimalType
	
	// Normal light
	if (scene == 1) {
		sendCommand(FF_CR_Effect, OFF)
		sendCommand(FF_CR_LightTemperature, 100);
		sendCommand(FF_CR_LightBrightness, 80);
		postUpdate(FF_CR_WorkLight, OFF)
		postUpdate(FF_CR_MovieLight, OFF)
		postUpdate(FF_CR_AllOff, OFF)
	// Work light
	} else if (scene == 2) {
		sendCommand(FF_CR_Effect, OFF)
		sendCommand(FF_CR_LightTemperature, 0);
		sendCommand(FF_CR_LightBrightness, 100);
		postUpdate(FF_CR_NormalLight, OFF)
		postUpdate(FF_CR_MovieLight, OFF)
		postUpdate(FF_CR_AllOff, OFF)
	// Passive light
	} else if (scene == 3) {
		sendCommand(FF_CR_Effect, ON)
		sendCommand(FF_CR_LightBrightness, 50);
		sendCommand(FF_CR_LightTemperature, 0);
		postUpdate(FF_CR_NormalLight, OFF)
		postUpdate(FF_CR_WorkLight, OFF)
		postUpdate(FF_CR_AllOff, OFF)
	// light off
	} else if (scene == 0) {
		callScript("nightLightOrOff")
	}
end

rule DashButtonPushed
when 
	Channel "amazondashbutton:dashbutton:50-f5-da-79-96-eb:press" triggered	
then
	if (FF_CR_LightScene.state > 0) {
		sendCommand(FF_CR_LightScene, 0)
		postUpdate(FF_CR_LightScene, 0)
	} else {
		sendCommand(FF_CR_LightScene, 1)
		postUpdate(FF_CR_LightScene, 1)
	}
end

rule MusicGenreChanged
when 
	Item FF_CR_MusicGenre received command
then

	var Number genre = FF_CR_MusicGenre.state as DecimalType
	
	// Off
	if (genre == 0) {
		sendCommand(FF_CR_Stop, ON)
	// Rock
	} else if (genre == 1) {
		sendCommand(FF_CR_PlayURI, "http://NB-P-RICHTER:8081/static/rock.mp3")
		// sendCommand(FF_CR_PlayURI, "http://NB-P-RICHTER:8080/static/rock.mp3")
		postUpdate(FF_CR_PopMusic, OFF)
		postUpdate(FF_CR_AllOff, OFF)
	// Poop
	} else if (genre == 2) {
		sendCommand(FF_CR_PlayURI, "http://NB-P-RICHTER:8081/static/pop.mp3"
		// sendCommand(FF_CR_PlayURI, "http://NB-P-RICHTER:8080/static/pop.mp3"
		postUpdate(FF_CR_RockMusic, OFF)
		postUpdate(FF_CR_AllOff, OFF)
	}
end

rule AllOff
when 
	Item FF_CR_AllOff received command ON
then
	sendCommand(FF_CR_Stop, ON)
	if (FF_CR_Effect.state == ON) {
		sendCommand(FF_CR_Effect, OFF)
	}
	sendCommand(FF_CR_LightBrightness, 0)		
	postUpdate(FF_CR_NormalLight, OFF)
	postUpdate(FF_CR_MovieLight, OFF)
	postUpdate(FF_CR_WorkLight, OFF)
	postUpdate(FF_CR_RockMusic, OFF)
	postUpdate(FF_CR_PopMusic, OFF)
	postUpdate(FF_CR_LightScene, 0)
	postUpdate(FF_CR_MusicGenre, 0)
end

rule DoorBellRings
when
	Item GF_EA_Doorbell changed to ON//received command ON 
//	Channel "serialthing_doorbell_COM4_doorbell" received command ON //changed from OFF to ON
then
	sendCommand(GF_EA_DoorBellSound, "http://NB-P-RICHTER:8081/static/doorbell.mp3")	
	// sendCommand(GF_EA_DoorBellSound, "http://NB-P-RICHTER:8080/static/doorbell.mp3")
	sendCommand(FF_CR_DoorbellL, 'SELECT')
	// postUpdate(GF_EA_Doorbell, OFF)
end

rule VoiceCommandReceived
when
	Item VoiceCommand received command
then
	var String command = VoiceCommand.state.toString.toLowerCase
	if (command.equals("licht an")) {
		sendCommand(FF_CR_LightScene, 1)
	} else if (command.equals("arbeitslicht an")) {
		sendCommand(FF_CR_LightScene, 2)
	} else if (command.equals("filmlicht an") || command.equals("film licht an")) {
		sendCommand(FF_CR_LightScene, 3)
	} else if (command.equals("spiele rock")) {
		sendCommand(FF_CR_MusicGenre, 1)
	} else if (command.equals("spiele pop")) {
		sendCommand(FF_CR_MusicGenre, 2)
	} else if (command.equals("musik aus")) {
		sendCommand(FF_CR_MusicGenre, 0)
	} else if (command.equals("alles aus")) {
		sendCommand(FF_CR_AllOff, ON)
	} else if (command.equals("es klingelt")) {
		sendCommand(GF_EA_Doorbell, ON)
	}
end	
	
rule AfterOpenHABStarted
when
	System started
then
	sendCommand(FF_CR_DoorBellVolume, 45)
	postUpdate(FF_CR_Scene, 0)
end

//
//rule DoorBellRings
//when 
//	Item enDoorBell received command ON
//then
//	sendCommand(enDoorBell, "jemand klingelt")
//	sendCommand(lrSonosNotif, "http://192.168.100.57:8080/static/doorbell.mp3")
//	sendCommand(enDoorBell, "-")
//end
//
//rule lrSonosPlayPauseChanged
//when 
//	Item lrSonosPlayPause received command OFF
//then
//	sendCommand(lrSonosNotif, "http://192.168.100.57:8080/static/doorbell.mp3")
//end
